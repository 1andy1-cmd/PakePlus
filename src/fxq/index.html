<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£è¡Œæ£‹æ¸¸æˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#F97316',
                        player1: '#EF4444',
                        player2: '#10B981',
                        player3: '#8B5CF6',
                        player4: '#F59E0B',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .chess-shadow {
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.1);
            }
            .board-grid {
                display: grid;
                grid-template-columns: repeat(11, 1fr);
                grid-template-rows: repeat(11, 1fr);
            }
            .home-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: repeat(2, 1fr);
            }
            .safe-path {
                background-color: rgba(255, 255, 255, 0.2);
            }
            .dice-rolling {
                animation: roll 0.5s linear infinite;
            }
            @keyframes roll {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            .player-piece {
                transition: all 0.5s ease;
            }
            .player-piece.jump {
                animation: jump 0.3s ease-in-out;
            }
            @keyframes jump {
                0%, 100% { transform: translateY(0); }
                50% { transform: translateY(-10px); }
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen flex flex-col items-center justify-center p-4 font-sans">
    <div class="max-w-6xl w-full mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
        <!-- æ¸¸æˆæ ‡é¢˜ -->
        <header class="bg-gradient-to-r from-primary to-indigo-600 text-white p-6 text-center">
            <h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold flex items-center justify-center">
                <i class="fa fa-paper-plane-o mr-3"></i>é£è¡Œæ£‹æ¸¸æˆ
            </h1>
            <p class="mt-2 text-white/80 text-[clamp(1rem,2vw,1.2rem)]">ä¸ç”µè„‘ä¸€èµ·äº«å—é£è¡Œæ£‹çš„ä¹è¶£ï¼</p>
        </header>

        <!-- æ¸¸æˆä¸»ä½“ -->
        <main class="flex flex-col lg:flex-row p-4 md:p-6 gap-6">
            <!-- æ¸¸æˆæ§åˆ¶é¢æ¿ -->
            <div class="lg:w-1/4 flex flex-col gap-4">
                <div class="bg-gray-50 rounded-xl p-5 shadow-md">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fa fa-sliders mr-2"></i>æ¸¸æˆæ§åˆ¶
                    </h2>
                    <div class="flex flex-col gap-3">
                        <button id="startGame" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center">
                            <i class="fa fa-play mr-2"></i>å¼€å§‹æ¸¸æˆ
                        </button>
                        <button id="resetGame" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center">
                            <i class="fa fa-refresh mr-2"></i>é‡ç½®æ¸¸æˆ
                        </button>
                        <div class="relative">
                            <label for="playerCount" class="block text-sm font-medium text-gray-700 mb-1">ç©å®¶æ•°é‡</label>
                            <select id="playerCount" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                <option value="1">1äºº vs ç”µè„‘</option>
                                <option value="2">1äºº vs 2ç”µè„‘</option>
                                <option value="3">1äºº vs 3ç”µè„‘</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ç©å®¶ä¿¡æ¯ -->
                <div class="bg-gray-50 rounded-xl p-5 shadow-md">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fa fa-users mr-2"></i>ç©å®¶ä¿¡æ¯
                    </h2>
                    <div id="playerInfo" class="space-y-3">
                        <!-- ç©å®¶ä¿¡æ¯å°†åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- éª°å­åŒºåŸŸ -->
                <div class="bg-gray-50 rounded-xl p-5 shadow-md flex flex-col items-center">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">æ·éª°å­</h2>
                    <div id="diceContainer" class="bg-white rounded-lg p-5 w-full aspect-square max-w-[120px] flex items-center justify-center cursor-pointer hover:shadow-lg transition-all duration-300">
                        <div id="dice" class="text-4xl font-bold">ğŸ²</div>
                    </div>
                    <div id="diceValue" class="mt-3 text-xl font-bold text-primary">ç‚¹å‡»éª°å­å¼€å§‹æ¸¸æˆ</div>
                </div>

                <!-- éŸ³é¢‘æ§åˆ¶ -->
                <div class="bg-gray-50 rounded-xl p-5 shadow-md">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fa fa-music mr-2"></i>èƒŒæ™¯éŸ³ä¹
                    </h2>
                    <div class="flex items-center justify-between">
                        <button id="playMusic" class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center">
                            <i class="fa fa-play mr-2"></i>æ’­æ”¾
                        </button>
                        <button id="pauseMusic" class="bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center">
                            <i class="fa fa-pause mr-2"></i>æš‚åœ
                        </button>
                        <input type="range" id="volumeControl" min="0" max="1" step="0.1" value="0.5" 
                               class="w-24 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary">
                    </div>
                    <audio id="bgMusic" loop>
                        <source src="1.mp3" type="audio/mpeg">
                        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
                    </audio>
                </div>
            </div>

            <!-- æ¸¸æˆæ£‹ç›˜ -->
            <div class="lg:w-3/4 bg-gray-50 rounded-xl p-4 md:p-6 shadow-md">
                <div class="aspect-square w-full relative">
                    <div id="gameBoard" class="board-grid w-full h-full bg-gradient-to-br from-blue-700 to-indigo-800 rounded-lg p-4">
                        <!-- æ¸¸æˆæ£‹ç›˜å°†åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    
                    <!-- æ¸¸æˆæ¶ˆæ¯æç¤º -->
                    <div id="gameMessage" class="absolute top-4 left-1/2 transform -translate-x-1/2 bg-white/90 backdrop-blur-sm text-gray-800 px-6 py-3 rounded-full shadow-lg z-10 transition-all duration-500 opacity-0">
                        æ¸¸æˆæ¶ˆæ¯å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ
                    </div>
                </div>
            </div>
        </main>

        <!-- æ¸¸æˆè¯´æ˜ -->
        <footer class="bg-gray-100 p-6 text-gray-700">
            <h2 class="text-xl font-semibold mb-3 flex items-center">
                <i class="fa fa-info-circle mr-2"></i>æ¸¸æˆè¯´æ˜
            </h2>
            <ul class="list-disc pl-5 space-y-1">
                <li>ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"æŒ‰é’®å¼€å§‹æ–°çš„æ¸¸æˆ</li>
                <li>ä½ æ˜¯ç©å®¶1ï¼Œæ§åˆ¶çº¢è‰²æ£‹å­ï¼Œç”µè„‘æ§åˆ¶å…¶ä»–é¢œè‰²æ£‹å­</li>
                <li>æ¯ä½ç©å®¶è½®æµæ·éª°å­ï¼Œæ ¹æ®éª°å­ç‚¹æ•°ç§»åŠ¨æ£‹å­</li>
                <li>æ·å‡º6ç‚¹å¯ä»¥é¢å¤–å†æ·ä¸€æ¬¡ï¼Œå¹¶å¯ä»¥è®©ä¸€ä¸ªæ£‹å­ä»åŸºåœ°å‡ºå‘</li>
                <li>å¦‚æœä½ çš„æ£‹å­è½åœ¨å…¶ä»–ç©å®¶çš„æ£‹å­ä¸Šï¼Œå¯¹æ–¹æ£‹å­å°†è¢«é€å›åŸºåœ°</li>
                <li>ç‡å…ˆå°†æ‰€æœ‰æ£‹å­ç§»åŠ¨åˆ°ç»ˆç‚¹çš„ç©å®¶è·èƒœ</li>
            </ul>
        </footer>
    </div>

    <!-- æ¸¸æˆç»“æŸå¼¹çª— -->
    <div id="gameOverModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-8 max-w-md w-full shadow-2xl transform transition-all duration-300 scale-95 opacity-0" id="modalContent">
            <div class="text-center">
                <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-green-100 text-green-600 mb-4">
                    <i class="fa fa-trophy text-3xl"></i>
                </div>
                <h3 id="winnerText" class="text-2xl font-bold text-gray-900 mb-2">æ¸¸æˆç»“æŸ</h3>
                <p id="winnerMessage" class="text-gray-600 mb-6">ç©å®¶è·èƒœï¼</p>
                <div class="flex justify-center">
                    <button id="playAgain" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-6 rounded-lg transition-all duration-300">
                        å†ç©ä¸€æ¬¡
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // æ¸¸æˆå¸¸é‡
            const BOARD_SIZE = 11;
            const PATH_LENGTH = 52;
            const SAFE_SPACES = [0, 13, 26, 39];
            const HOME_PATHS = {
                1: [40, 41, 42, 43, 44, 45],
                2: [46, 47, 48, 49, 50, 51],
                3: [52, 53, 54, 55, 56, 57],
                4: [58, 59, 60, 61, 62, 63]
            };

            // ç©å®¶é¢œè‰²å’Œèµ·å§‹ä½ç½®
            const PLAYERS = {
                1: { color: 'player1', home: [0, 0], start: 0, base: [[0, 0], [0, 1], [1, 0], [1, 1]] },
                2: { color: 'player2', home: [0, 10], start: 13, base: [[0, 9], [0, 10], [1, 9], [1, 10]] },
                3: { color: 'player3', home: [10, 10], start: 26, base: [[9, 9], [9, 10], [10, 9], [10, 10]] },
                4: { color: 'player4', home: [10, 0], start: 39, base: [[9, 0], [9, 1], [10, 0], [10, 1]] }
            };

            // æ¸¸æˆçŠ¶æ€
            let gameState = {
                players: {},
                currentPlayer: 1,
                diceRolled: false,
                diceValue: 0,
                gameStarted: false,
                gameOver: false
            };

            // éŸ³é¢‘æ§åˆ¶
            const bgMusic = document.getElementById('bgMusic');
            const playMusicBtn = document.getElementById('playMusic');
            const pauseMusicBtn = document.getElementById('pauseMusic');
            const volumeControl = document.getElementById('volumeControl');

            playMusicBtn.addEventListener('click', () => {
                bgMusic.play().catch(e => {
                    console.error('æ’­æ”¾éŸ³ä¹å¤±è´¥:', e);
                    showGameMessage('ç”±äºæµè§ˆå™¨é™åˆ¶ï¼Œéœ€è¦å…ˆä¸é¡µé¢äº¤äº’æ‰èƒ½æ’­æ”¾éŸ³ä¹');
                });
            });

            pauseMusicBtn.addEventListener('click', () => {
                bgMusic.pause();
            });

            volumeControl.addEventListener('input', () => {
                bgMusic.volume = volumeControl.value;
            });

            // æ¸¸æˆåˆå§‹åŒ–
            function initGame() {
                const playerCount = parseInt(document.getElementById('playerCount').value) + 1; // ç©å®¶+ç”µè„‘
                gameState = {
                    players: {},
                    currentPlayer: 1,
                    diceRolled: false,
                    diceValue: 0,
                    gameStarted: true,
                    gameOver: false
                };

                // åˆå§‹åŒ–ç©å®¶
                for (let i = 1; i <= playerCount; i++) {
                    gameState.players[i] = {
                        pieces: [
                            { position: -1, onPath: false },
                            { position: -1, onPath: false },
                            { position: -1, onPath: false },
                            { position: -1, onPath: false }
                        ],
                        color: PLAYERS[i].color,
                        home: PLAYERS[i].home,
                        start: PLAYERS[i].start,
                        base: PLAYERS[i].base,
                        isComputer: i > 1 // ç©å®¶1æ˜¯äººï¼Œå…¶ä»–æ˜¯ç”µè„‘
                    };
                }

                renderBoard();
                renderPlayerInfo();
                updateCurrentPlayer();
                showGameMessage(`æ¸¸æˆå¼€å§‹ï¼ä½ çš„å›åˆï¼Œè¯·æ·éª°å­`);
            }

            // æ¸²æŸ“æ¸¸æˆæ£‹ç›˜
            function renderBoard() {
                const gameBoard = document.getElementById('gameBoard');
                gameBoard.innerHTML = '';

                // åˆ›å»ºæ£‹ç›˜æ ¼å­
                for (let row = 0; row < BOARD_SIZE; row++) {
                    for (let col = 0; col < BOARD_SIZE; col++) {
                        const cell = document.createElement('div');
                        cell.className = 'border border-gray-700/20 flex items-center justify-center relative';
                        cell.dataset.row = row;
                        cell.dataset.col = col;
                        
                        // ç¡®å®šæ ¼å­ç±»å‹
                        const cellType = getCellType(row, col);
                        if (cellType === 'corner') {
                            const playerId = getCornerPlayer(row, col);
                            cell.className += ` bg-${PLAYERS[playerId].color}/20`;
                            
                            // ç»˜åˆ¶ç©å®¶åŸºåœ°
                            renderBase(cell, playerId);
                        } else if (cellType === 'center') {
                            cell.className += ' bg-white/10';
                        } else if (cellType === 'path') {
                            const pathIndex = getPathIndex(row, col);
                            cell.className += ' bg-gray-100/30';
                            
                            // ä¸ºç‰¹æ®Šä½ç½®æ·»åŠ æ ‡è®°
                            if (SAFE_SPACES.includes(pathIndex)) {
                                cell.className += ' safe-path';
                                const marker = document.createElement('div');
                                marker.className = 'w-3 h-3 rounded-full bg-white/70';
                                cell.appendChild(marker);
                            }
                            
                            // ç»˜åˆ¶è·¯å¾„ç¼–å·ï¼ˆè°ƒè¯•ç”¨ï¼‰
                            // const pathNum = document.createElement('div');
                            // pathNum.className = 'absolute top-0 left-0 text-xs text-gray-600';
                            // pathNum.textContent = pathIndex;
                            // cell.appendChild(pathNum);
                        } else if (cellType === 'home-path') {
                            const homePathInfo = getHomePathInfo(row, col);
                            if (homePathInfo) {
                                const { playerId, pathIndex } = homePathInfo;
                                cell.className += ` bg-${PLAYERS[playerId].color}/30`;
                                
                                // ç»˜åˆ¶ç»ˆç‚¹æ ‡è®°
                                if (pathIndex === 5) {
                                    const finishMarker = document.createElement('div');
                                    finishMarker.className = 'w-4 h-4 rounded-full bg-white/70 flex items-center justify-center';
                                    finishMarker.innerHTML = '<i class="fa fa-flag text-xs text-gray-700"></i>';
                                    cell.appendChild(finishMarker);
                                }
                            }
                        }
                        
                        gameBoard.appendChild(cell);
                    }
                }
                
                // ç»˜åˆ¶æ£‹å­
                renderPieces();
            }

            // ç¡®å®šæ ¼å­ç±»å‹
            function getCellType(row, col) {
                // è§’è½åŒºåŸŸï¼ˆç©å®¶åŸºåœ°ï¼‰
                if ((row <= 1 && col <= 1) || 
                    (row <= 1 && col >= 9) || 
                    (row >= 9 && col >= 9) || 
                    (row >= 9 && col <= 1)) {
                    return 'corner';
                }
                
                // ä¸­å¿ƒåŒºåŸŸ
                if (row >= 4 && row <= 6 && col >= 4 && col <= 6) {
                    return 'center';
                }
                
                // ä¸»è·¯å¾„
                if (
                    (row === 0 && col >= 2 && col <= 8) || 
                    (row === 10 && col >= 2 && col <= 8) || 
                    (col === 0 && row >= 2 && row <= 8) || 
                    (col === 10 && row >= 2 && row <= 8) ||
                    (row >= 2 && row <= 4 && col === 2) ||
                    (row >= 2 && row <= 4 && col === 8) ||
                    (row >= 6 && row <= 8 && col === 2) ||
                    (row >= 6 && row <= 8 && col === 8)
                ) {
                    return 'path';
                }
                
                // ç©å®¶å›å®¶è·¯å¾„
                if (
                    (row >= 2 && row <= 3 && col === 4) || (row === 2 && col >= 4 && col <= 5) || // ç©å®¶1
                    (row >= 2 && row <= 3 && col === 6) || (row === 2 && col >= 5 && col <= 6) || // ç©å®¶2
                    (row >= 7 && row <= 8 && col === 6) || (row === 8 && col >= 5 && col <= 6) || // ç©å®¶3
                    (row >= 7 && row <= 8 && col === 4) || (row === 8 && col >= 4 && col <= 5)    // ç©å®¶4
                ) {
                    return 'home-path';
                }
                
                return 'empty';
            }

            // è·å–è§’è½åŒºåŸŸçš„ç©å®¶ID
            function getCornerPlayer(row, col) {
                if (row <= 1 && col <= 1) return 1;
                if (row <= 1 && col >= 9) return 2;
                if (row >= 9 && col >= 9) return 3;
                if (row >= 9 && col <= 1) return 4;
                return null;
            }

            // æ¸²æŸ“ç©å®¶åŸºåœ°
            function renderBase(cell, playerId) {
                const base = document.createElement('div');
                base.className = 'home-grid w-full h-full';
                
                for (let i = 0; i < 2; i++) {
                    for (let j = 0; j < 2; j++) {
                        const baseCell = document.createElement('div');
                        baseCell.className = `border-2 border-${PLAYERS[playerId].color}/50 rounded-md flex items-center justify-center`;
                        base.appendChild(baseCell);
                    }
                }
                
                cell.appendChild(base);
            }

            // è·å–è·¯å¾„ç´¢å¼•
            function getPathIndex(row, col) {
                // é¡¶éƒ¨æ°´å¹³è·¯å¾„ (0-6)
                if (row === 0 && col >= 2 && col <= 8) return col - 2;
                
                // å³ä¾§å‚ç›´è·¯å¾„ (7-13)
                if (col === 10 && row >= 2 && row <= 8) return row + 5;
                
                // åº•éƒ¨æ°´å¹³è·¯å¾„ (14-20)
                if (row === 10 && col >= 2 && col <= 8) return 26 - col;
                
                // å·¦ä¾§å‚ç›´è·¯å¾„ (21-27)
                if (col === 0 && row >= 2 && row <= 8) return 33 - row;
                
                // å³ä¸Šå¼¯æ›² (28-29)
                if (row >= 2 && row <= 4 && col === 8) return row + 25;
                
                // å³ä¸‹å¼¯æ›² (30-31)
                if (row >= 6 && row <= 8 && col === 8) return 41 - row;
                
                // å·¦ä¸‹å¼¯æ›² (32-33)
                if (row >= 6 && row <= 8 && col === 2) return row + 25;
                
                // å·¦ä¸Šå¼¯æ›² (34-35)
                if (row >= 2 && row <= 4 && col === 2) return 41 - row;
                
                return -1;
            }

            // è·å–å›å®¶è·¯å¾„ä¿¡æ¯
            function getHomePathInfo(row, col) {
                // ç©å®¶1å›å®¶è·¯å¾„
                if ((row >= 2 && row <= 3 && col === 4) || (row === 2 && col >= 4 && col <= 5)) {
                    if (row === 2 && col === 4) return { playerId: 1, pathIndex: 0 };
                    if (row === 2 && col === 5) return { playerId: 1, pathIndex: 1 };
                    if (row === 3 && col === 4) return { playerId: 1, pathIndex: 2 };
                    if (row === 4 && col === 4) return { playerId: 1, pathIndex: 3 };
                    if (row === 5 && col === 4) return { playerId: 1, pathIndex: 4 };
                    if (row === 6 && col === 4) return { playerId: 1, pathIndex: 5 };
                }
                
                // ç©å®¶2å›å®¶è·¯å¾„
                if ((row >= 2 && row <= 3 && col === 6) || (row === 2 && col >= 5 && col <= 6)) {
                    if (row === 2 && col === 6) return { playerId: 2, pathIndex: 0 };
                    if (row === 2 && col === 5) return { playerId: 2, pathIndex: 1 };
                    if (row === 3 && col === 6) return { playerId: 2, pathIndex: 2 };
                    if (row === 4 && col === 6) return { playerId: 2, pathIndex: 3 };
                    if (row === 5 && col === 6) return { playerId: 2, pathIndex: 4 };
                    if (row === 6 && col === 6) return { playerId: 2, pathIndex: 5 };
                }
                
                // ç©å®¶3å›å®¶è·¯å¾„
                if ((row >= 7 && row <= 8 && col === 6) || (row === 8 && col >= 5 && col <= 6)) {
                    if (row === 8 && col === 6) return { playerId: 3, pathIndex: 0 };
                    if (row === 8 && col === 5) return { playerId: 3, pathIndex: 1 };
                    if (row === 7 && col === 6) return { playerId: 3, pathIndex: 2 };
                    if (row === 6 && col === 6) return { playerId: 3, pathIndex: 3 };
                    if (row === 5 && col === 6) return { playerId: 3, pathIndex: 4 };
                    if (row === 4 && col === 6) return { playerId: 3, pathIndex: 5 };
                }
                
                // ç©å®¶4å›å®¶è·¯å¾„
                if ((row >= 7 && row <= 8 && col === 4) || (row === 8 && col >= 4 && col <= 5)) {
                    if (row === 8 && col === 4) return { playerId: 4, pathIndex: 0 };
                    if (row === 8 && col === 5) return { playerId: 4, pathIndex: 1 };
                    if (row === 7 && col === 4) return { playerId: 4, pathIndex: 2 };
                    if (row === 6 && col === 4) return { playerId: 4, pathIndex: 3 };
                    if (row === 5 && col === 4) return { playerId: 4, pathIndex: 4 };
                    if (row === 4 && col === 4) return { playerId: 4, pathIndex: 5 };
                }
                
                return null;
            }

            // æ ¹æ®ä½ç½®è·å–æ ¼å­åæ ‡
            function getPositionCoordinates(playerId, position) {
                const player = gameState.players[playerId];
                
                // æ£‹å­åœ¨åŸºåœ°
                if (position === -1) {
                    for (let i = 0; i < player.pieces.length; i++) {
                        if (player.pieces[i].position === -1) {
                            return player.base[i];
                        }
                    }
                    return player.base[0]; // é»˜è®¤è¿”å›ç¬¬ä¸€ä¸ªåŸºåœ°ä½ç½®
                }
                
                // æ£‹å­åœ¨ä¸»è·¯å¾„
                if (position >= 0 && position < PATH_LENGTH) {
                    // è®¡ç®—ä¸»è·¯å¾„ä¸Šçš„åæ ‡
                    // è¿™é‡Œéœ€è¦æ ¹æ®è·¯å¾„ç´¢å¼•æ˜ å°„åˆ°æ£‹ç›˜åæ ‡
                    // ç®€åŒ–ç‰ˆå®ç°ï¼Œå®é™…éœ€è¦æ ¹æ®getPathIndexçš„é€†è¿ç®—
                    for (let row = 0; row < BOARD_SIZE; row++) {
                        for (let col = 0; col < BOARD_SIZE; col++) {
                            if (getCellType(row, col) === 'path' && getPathIndex(row, col) === position) {
                                return [row, col];
                            }
                        }
                    }
                }
                
                // æ£‹å­åœ¨å›å®¶è·¯å¾„
                if (position >= PATH_LENGTH && position < PATH_LENGTH + 6) {
                    const homePathIndex = position - PATH_LENGTH;
                    
                    // æ ¹æ®ç©å®¶IDå’Œå›å®¶è·¯å¾„ç´¢å¼•ç¡®å®šåæ ‡
                    // è¿™é‡Œéœ€è¦æ ¹æ®getHomePathInfoçš„é€†è¿ç®—
                    if (playerId === 1) {
                        if (homePathIndex === 0) return [2, 4];
                        if (homePathIndex === 1) return [2, 5];
                        if (homePathIndex === 2) return [3, 4];
                        if (homePathIndex === 3) return [4, 4];
                        if (homePathIndex === 4) return [5, 4];
                        if (homePathIndex === 5) return [6, 4];
                    } else if (playerId === 2) {
                        if (homePathIndex === 0) return [2, 6];
                        if (homePathIndex === 1) return [2, 5];
                        if (homePathIndex === 2) return [3, 6];
                        if (homePathIndex === 3) return [4, 6];
                        if (homePathIndex === 4) return [5, 6];
                        if (homePathIndex === 5) return [6, 6];
                    } else if (playerId === 3) {
                        if (homePathIndex === 0) return [8, 6];
                        if (homePathIndex === 1) return [8, 5];
                        if (homePathIndex === 2) return [7, 6];
                        if (homePathIndex === 3) return [6, 6];
                        if (homePathIndex === 4) return [5, 6];
                        if (homePathIndex === 5) return [4, 6];
                    } else if (playerId === 4) {
                        if (homePathIndex === 0) return [8, 4];
                        if (homePathIndex === 1) return [8, 5];
                        if (homePathIndex === 2) return [7, 4];
                        if (homePathIndex === 3) return [6, 4];
                        if (homePathIndex === 4) return [5, 4];
                        if (homePathIndex === 5) return [4, 4];
                    }
                }
                
                return [0, 0]; // é»˜è®¤è¿”å›åæ ‡
            }

            // æ¸²æŸ“æ£‹å­
            function renderPieces() {
                // ç§»é™¤æ‰€æœ‰ç°æœ‰æ£‹å­
                document.querySelectorAll('.player-piece').forEach(piece => piece.remove());
                
                for (let playerId in gameState.players) {
                    const player = gameState.players[playerId];
                    
                    player.pieces.forEach((piece, pieceIndex) => {
                        if (piece.position >= -1) {
                            const [row, col] = getPositionCoordinates(playerId, piece.position);
                            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                            
                            if (cell) {
                                const pieceElement = document.createElement('div');
                                pieceElement.className = `player-piece w-5 h-5 rounded-full bg-${player.color} shadow-lg chess-shadow flex items-center justify-center text-white text-xs font-bold z-10`;
                                pieceElement.textContent = pieceIndex + 1;
                                pieceElement.dataset.player = playerId;
                                pieceElement.dataset.piece = pieceIndex;
                                
                                // å¦‚æœæ˜¯å½“å‰ç©å®¶çš„æ£‹å­ä¸”å·²ç»æ·éª°å­ï¼Œåˆ™æ·»åŠ ç‚¹å‡»äº‹ä»¶
                                if (parseInt(playerId) === gameState.currentPlayer && gameState.diceRolled && !player.isComputer) {
                                    pieceElement.classList.add('cursor-pointer', 'hover:scale-110', 'transition-transform');
                                    pieceElement.addEventListener('click', () => movePiece(playerId, pieceIndex));
                                }
                                
                                cell.appendChild(pieceElement);
                            }
                        }
                    });
                }
            }

            // æ¸²æŸ“ç©å®¶ä¿¡æ¯
            function renderPlayerInfo() {
                const playerInfoContainer = document.getElementById('playerInfo');
                playerInfoContainer.innerHTML = '';
                
                for (let playerId in gameState.players) {
                    const player = gameState.players[playerId];
                    const playerElement = document.createElement('div');
                    playerElement.className = `flex items-center p-3 rounded-lg ${parseInt(playerId) === gameState.currentPlayer ? 'bg-primary/10 border-l-4 border-primary' : 'bg-gray-100'}`;
                    
                    // ç©å®¶é¢œè‰²æŒ‡ç¤ºå™¨
                    const colorIndicator = document.createElement('div');
                    colorIndicator.className = `w-4 h-4 rounded-full bg-${player.color} mr-3`;
                    
                    // ç©å®¶åç§°å’ŒçŠ¶æ€
                    const playerText = document.createElement('div');
                    playerText.className = 'flex-1';
                    playerText.innerHTML = `
                        <div class="font-medium">${player.isComputer ? 'ç”µè„‘ ' : 'ä½  '}(${playerId})</div>
                        <div class="text-sm text-gray-600">
                            åŸºåœ°: ${player.pieces.filter(p => p.position === -1).length}
                            &nbsp;&nbsp;
                            ç»ˆç‚¹: ${player.pieces.filter(p => p.position >= PATH_LENGTH + 5).length}/4
                        </div>
                    `;
                    
                    playerElement.appendChild(colorIndicator);
                    playerElement.appendChild(playerText);
                    playerInfoContainer.appendChild(playerElement);
                }
            }

            // æ›´æ–°å½“å‰ç©å®¶
            function updateCurrentPlayer() {
                renderPlayerInfo();
                
                if (gameState.players[gameState.currentPlayer].isComputer) {
                    showGameMessage(`ç”µè„‘ ${gameState.currentPlayer} çš„å›åˆï¼Œæ­£åœ¨æ€è€ƒ...`);
                    setTimeout(computerRollDice, 1500);
                } else {
                    showGameMessage(`ä½ çš„å›åˆï¼Œè¯·æ·éª°å­`);
                }
            }

            // æ·éª°å­
            function rollDice() {
                if (!gameState.gameStarted || gameState.gameOver || gameState.diceRolled) return;
                
                const dice = document.getElementById('dice');
                const diceValueDisplay = document.getElementById('diceValue');
                
                // éª°å­åŠ¨ç”»
                dice.classList.add('dice-rolling');
                diceValueDisplay.textContent = 'æ»šåŠ¨ä¸­...';
                
                // éšæœºéª°å­å€¼
                setTimeout(() => {
                    const diceValue = Math.floor(Math.random() * 6) + 1;
                    gameState.diceValue = diceValue;
                    gameState.diceRolled = true;
                    
                    dice.classList.remove('dice-rolling');
                    diceValueDisplay.textContent = `ä½ æ·å‡ºäº†: ${diceValue}`;
                    
                    // æ’­æ”¾æ·éª°å­éŸ³æ•ˆï¼ˆä½¿ç”¨HTML5 Audioï¼‰
                    const diceSound = new Audio('data:audio/wav;base64,UklGRoQFAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YY4AAAC+AgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA==');
                    diceSound.play();
                    
                    // æ˜¾ç¤ºå¯ä»¥ç§»åŠ¨çš„æ£‹å­
                    renderPieces();
                    
                    // å¦‚æœæ˜¯ç©å®¶å›åˆï¼Œæ˜¾ç¤ºæ“ä½œæç¤º
                    if (!gameState.players[gameState.currentPlayer].isComputer) {
                        // æ£€æŸ¥æ˜¯å¦æœ‰å¯ç§»åŠ¨çš„æ£‹å­
                        const canMove = canMoveAnyPiece();
                        if (!canMove) {
                            showGameMessage(`ä½ æ²¡æœ‰å¯ç§»åŠ¨çš„æ£‹å­ï¼Œå›åˆç»“æŸ`);
                            setTimeout(nextPlayer, 2000);
                        } else {
                            if (diceValue === 6) {
                                showGameMessage(`ä½ æ·å‡ºäº†6ç‚¹ï¼å¯ä»¥ç§»åŠ¨æ£‹å­æˆ–æ´¾å‡ºæ–°æ£‹å­`);
                            } else {
                                showGameMessage(`è¯·é€‰æ‹©ä¸€ä¸ªæ£‹å­ç§»åŠ¨ ${diceValue} æ­¥`);
                            }
                        }
                    } else {
                        // ç”µè„‘å›åˆï¼Œè‡ªåŠ¨é€‰æ‹©æœ€ä½³æ£‹å­ç§»åŠ¨
                        setTimeout(computerMove, 1500);
                    }
                }, 1000);
            }

            // ç”µè„‘æ·éª°å­
            function computerRollDice() {
                const dice = document.getElementById('dice');
                const diceValueDisplay = document.getElementById('diceValue');
                
                // éª°å­åŠ¨ç”»
                dice.classList.add('dice-rolling');
                diceValueDisplay.textContent = `ç”µè„‘ ${gameState.currentPlayer} æ­£åœ¨æ·éª°å­...`;
                
                // éšæœºéª°å­å€¼
                setTimeout(() => {
                    const diceValue = Math.floor(Math.random() * 6) + 1;
                    gameState.diceValue = diceValue;
                    gameState.diceRolled = true;
                    
                    dice.classList.remove('dice-rolling');
                    diceValueDisplay.textContent = `ç”µè„‘ ${gameState.currentPlayer} æ·å‡ºäº†: ${diceValue}`;
                    
                    // æ’­æ”¾æ·éª°å­éŸ³æ•ˆ
                    const diceSound = new Audio('data:audio/wav;base64,UklGRoQFAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YY4AAAC+AgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA==');
                    diceSound.play();
                    
                    // æ˜¾ç¤ºå¯ä»¥ç§»åŠ¨çš„æ£‹å­
                    renderPieces();
                    
                    // ç”µè„‘è‡ªåŠ¨é€‰æ‹©æœ€ä½³æ£‹å­ç§»åŠ¨
                    setTimeout(computerMove, 1500);
                }, 1000);
            }

            // ç”µè„‘ç§»åŠ¨æ£‹å­
            function computerMove() {
                const playerId = gameState.currentPlayer;
                const player = gameState.players[playerId];
                const diceValue = gameState.diceValue;
                
                // ç”µè„‘å†³ç­–é€»è¾‘
                // 1. ä¼˜å…ˆé€‰æ‹©å¯ä»¥å°†æ£‹å­ç§»å‡ºåŸºåœ°çš„6ç‚¹
                // 2. ä¼˜å…ˆé€‰æ‹©å¯ä»¥åƒæ‰ç©å®¶æ£‹å­çš„ç§»åŠ¨
                // 3. ä¼˜å…ˆé€‰æ‹©å¯ä»¥è¿›å…¥å›å®¶è·¯å¾„çš„ç§»åŠ¨
                // 4. ä¼˜å…ˆé€‰æ‹©å¯ä»¥åˆ°è¾¾ç»ˆç‚¹çš„ç§»åŠ¨
                // 5. é€‰æ‹©ç§»åŠ¨è·ç¦»æœ€è¿œçš„æ£‹å­
                
                // æŸ¥æ‰¾æ‰€æœ‰å¯ä»¥ç§»åŠ¨çš„æ£‹å­
                const movablePieces = [];
                player.pieces.forEach((piece, pieceIndex) => {
                    if (canMovePiece(piece, diceValue)) {
                        movablePieces.push(pieceIndex);
                    }
                });
                
                if (movablePieces.length === 0) {
                    showGameMessage(`ç”µè„‘ ${playerId} æ²¡æœ‰å¯ç§»åŠ¨çš„æ£‹å­ï¼Œå›åˆç»“æŸ`);
                    setTimeout(nextPlayer, 1500);
                    return;
                }
                
                // è¯„ä¼°æ¯ä¸ªå¯ç§»åŠ¨æ£‹å­çš„å¾—åˆ†
                let bestPieceIndex = movablePieces[0];
                let bestScore = -Infinity;
                
                movablePieces.forEach(pieceIndex => {
                    const piece = player.pieces[pieceIndex];
                    let newPosition;
                    
                    // è®¡ç®—æ–°ä½ç½®
                    if (piece.position === -1 && diceValue === 6) {
                        newPosition = player.start;
                    } else {
                        if (piece.position >= 0 && piece.position < PATH_LENGTH) {
                            newPosition = piece.position + diceValue;
                            if (newPosition >= PATH_LENGTH) {
                                newPosition = PATH_LENGTH + (newPosition - PATH_LENGTH);
                            }
                        } else if (piece.position >= PATH_LENGTH) {
                            newPosition = piece.position + diceValue;
                        }
                    }
                    
                    if (newPosition > PATH_LENGTH + 5) {
                        newPosition = PATH_LENGTH + 5;
                    }
                    
                    // è¯„ä¼°ç§»åŠ¨çš„å¾—åˆ†
                    let score = 0;
                    
                    // åˆ°è¾¾ç»ˆç‚¹çš„å¾—åˆ†æœ€é«˜
                    if (newPosition === PATH_LENGTH + 5) {
                        score += 100;
                    }
                    
                    // è¿›å…¥å›å®¶è·¯å¾„çš„å¾—åˆ†è¾ƒé«˜
                    if (piece.position < PATH_LENGTH && newPosition >= PATH_LENGTH) {
                        score += 50;
                    }
                    
                    // åƒæ‰ç©å®¶æ£‹å­çš„å¾—åˆ†é«˜
                    if (newPosition < PATH_LENGTH && !SAFE_SPACES.includes(newPosition)) {
                        // æ£€æŸ¥æ˜¯å¦å¯ä»¥åƒæ‰å…¶ä»–ç©å®¶çš„æ£‹å­
                        for (let otherPlayerId in gameState.players) {
                            if (otherPlayerId === playerId) continue;
                            
                            const otherPlayer = gameState.players[otherPlayerId];
                            
                            otherPlayer.pieces.forEach(otherPiece => {
                                if (otherPiece.position === newPosition && !SAFE_SPACES.includes(newPosition)) {
                                    // å¦‚æœèƒ½åƒæ‰ç©å®¶çš„æ£‹å­ï¼Œå¾—åˆ†æ›´é«˜
                                    if (parseInt(otherPlayerId) === 1) {
                                        score += 80;
                                    } else {
                                        score += 30;
                                    }
                                }
                            });
                        }
                    }
                    
                    // ç§»åŠ¨è·ç¦»è¿œçš„å¾—åˆ†è¾ƒé«˜
                    score += piece.position === -1 ? 10 : newPosition - piece.position;
                    
                    // å¦‚æœæ˜¯6ç‚¹ï¼Œä¼˜å…ˆé€‰æ‹©ä»åŸºåœ°æ´¾å‡ºæ£‹å­
                    if (piece.position === -1 && diceValue === 6) {
                        score += 20;
                    }
                    
                    // æ›´æ–°æœ€ä½³é€‰æ‹©
                    if (score > bestScore) {
                        bestScore = score;
                        bestPieceIndex = pieceIndex;
                    }
                });
                
                // ç”µè„‘é€‰æ‹©ç§»åŠ¨çš„æ£‹å­
                showGameMessage(`ç”µè„‘ ${playerId} é€‰æ‹©ç§»åŠ¨æ£‹å­ ${bestPieceIndex + 1}`);
                
                // å»¶è¿Ÿæ‰§è¡Œç§»åŠ¨ï¼Œå¢åŠ æ¸¸æˆä½“éªŒ
                setTimeout(() => {
                    movePiece(playerId, bestPieceIndex);
                }, 1500);
            }

            // æ£€æŸ¥æ˜¯å¦æœ‰å¯ç§»åŠ¨çš„æ£‹å­
            function canMoveAnyPiece() {
                const player = gameState.players[gameState.currentPlayer];
                const diceValue = gameState.diceValue;
                
                // æ£€æŸ¥æ˜¯å¦æœ‰æ£‹å­å¯ä»¥ä»åŸºåœ°å‡ºå‘
                if (diceValue === 6 && player.pieces.some(p => p.position === -1)) {
                    return true;
                }
                
                // æ£€æŸ¥æ˜¯å¦æœ‰æ£‹å­å¯ä»¥åœ¨è·¯å¾„ä¸Šç§»åŠ¨
                return player.pieces.some(p => {
                    if (p.position === -1) return false; // åœ¨åŸºåœ°ä¸­
                    
                    // åœ¨å›å®¶è·¯å¾„ä¸­
                    if (p.position >= PATH_LENGTH) {
                        const homePathIndex = p.position - PATH_LENGTH;
                        return homePathIndex + diceValue <= 5;
                    }
                    
                    // åœ¨ä¸»è·¯å¾„ä¸­
                    return true;
                });
            }

            // ç§»åŠ¨æ£‹å­
            function movePiece(playerId, pieceIndex) {
                if (parseInt(playerId) !== gameState.currentPlayer || !gameState.diceRolled) return;
                
                const player = gameState.players[playerId];
                const piece = player.pieces[pieceIndex];
                const diceValue = gameState.diceValue;
                
                // æ£€æŸ¥æ˜¯å¦å¯ä»¥ç§»åŠ¨
                if (!canMovePiece(piece, diceValue)) {
                    showGameMessage('è¿™ä¸ªæ£‹å­ä¸èƒ½ç§»åŠ¨ï¼Œè¯·é€‰æ‹©å…¶ä»–æ£‹å­');
                    return;
                }
                
                // ç§»åŠ¨æ£‹å­
                let newPosition;
                
                // å¦‚æœæ£‹å­åœ¨åŸºåœ°ï¼Œä¸”æ·å‡º6ç‚¹ï¼Œåˆ™ä»åŸºåœ°å‡ºå‘
                if (piece.position === -1 && diceValue === 6) {
                    newPosition = player.start;
                } else {
                    // åœ¨ä¸»è·¯å¾„ä¸Šç§»åŠ¨
                    if (piece.position >= 0 && piece.position < PATH_LENGTH) {
                        newPosition = piece.position + diceValue;
                        
                        // å¦‚æœè¶…è¿‡ä¸»è·¯å¾„é•¿åº¦ï¼Œè¿›å…¥å›å®¶è·¯å¾„
                        if (newPosition >= PATH_LENGTH) {
                            newPosition = PATH_LENGTH + (newPosition - PATH_LENGTH);
                        }
                    } 
                    // åœ¨å›å®¶è·¯å¾„ä¸Šç§»åŠ¨
                    else if (piece.position >= PATH_LENGTH) {
                        newPosition = piece.position + diceValue;
                    }
                }
                
                // æ£€æŸ¥æ˜¯å¦å¯ä»¥ç§»åŠ¨åˆ°æ–°ä½ç½®
                if (newPosition > PATH_LENGTH + 5) {
                    // ç§»åŠ¨è¶…è¿‡ç»ˆç‚¹ï¼Œåªèƒ½ç§»åŠ¨åˆ°ç»ˆç‚¹
                    newPosition = PATH_LENGTH + 5;
                }
                
                // è®°å½•ç§»åŠ¨å‰çš„ä½ç½®
                const oldPosition = piece.position;
                
                // æ›´æ–°æ£‹å­ä½ç½®
                piece.position = newPosition;
                piece.onPath = newPosition >= 0;
                
                // æ£€æŸ¥æ˜¯å¦æœ‰æ£‹å­è¢«åƒæ‰
                checkAndCapturePieces(playerId, newPosition);
                
                // æ›´æ–°UI
                renderPieces();
                
                // æ·»åŠ ç§»åŠ¨åŠ¨ç”»
                const pieceElement = document.querySelector(`.player-piece[data-player="${playerId}"][data-piece="${pieceIndex}"]`);
                if (pieceElement) {
                    pieceElement.classList.add('jump');
                    setTimeout(() => pieceElement.classList.remove('jump'), 300);
                }
                
                // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
                if (checkGameOver(playerId)) {
                    gameState.gameOver = true;
                    showGameOverModal(playerId);
                    return;
                }
                
                // æ£€æŸ¥æ˜¯å¦éœ€è¦å†æ·ä¸€æ¬¡éª°å­ï¼ˆæ·å‡º6ç‚¹ï¼‰
                if (diceValue === 6 && newPosition !== PATH_LENGTH + 5) {
                    // æ·å‡º6ç‚¹ä¸”æ²¡æœ‰åˆ°è¾¾ç»ˆç‚¹ï¼Œç»§ç»­å›åˆ
                    gameState.diceRolled = false;
                    
                    if (player.isComputer) {
                        document.getElementById('diceValue').textContent = `ç”µè„‘ ${playerId} è·å¾—é¢å¤–å›åˆï¼Œæ­£åœ¨æ·éª°å­...`;
                        showGameMessage(`ç”µè„‘ ${playerId} æ·å‡ºäº†6ç‚¹ï¼è·å¾—é¢å¤–å›åˆ`);
                        setTimeout(computerRollDice, 1500);
                    } else {
                        document.getElementById('diceValue').textContent = 'ä½ è·å¾—é¢å¤–å›åˆï¼Œè¯·å†æ¬¡æ·éª°å­';
                        showGameMessage('ä½ æ·å‡ºäº†6ç‚¹ï¼è·å¾—é¢å¤–å›åˆ');
                    }
                } else {
                    // å›åˆç»“æŸï¼Œè½®åˆ°ä¸‹ä¸€ä¸ªç©å®¶
                    setTimeout(nextPlayer, 1500);
                }
            }

            // æ£€æŸ¥æ£‹å­æ˜¯å¦å¯ä»¥ç§»åŠ¨
            function canMovePiece(piece, diceValue) {
                // å¦‚æœæ£‹å­åœ¨åŸºåœ°ï¼Œå¿…é¡»æ·å‡º6ç‚¹æ‰èƒ½å‡ºå‘
                if (piece.position === -1) {
                    return diceValue === 6;
                }
                
                // åœ¨å›å®¶è·¯å¾„ä¸­
                if (piece.position >= PATH_LENGTH) {
                    const homePathIndex = piece.position - PATH_LENGTH;
                    return homePathIndex + diceValue <= 5;
                }
                
                // åœ¨ä¸»è·¯å¾„ä¸­
                return true;
            }

            // æ£€æŸ¥å¹¶åƒæ‰å…¶ä»–ç©å®¶çš„æ£‹å­
            function checkAndCapturePieces(playerId, position) {
                // å¦‚æœæ˜¯åœ¨å›å®¶è·¯å¾„æˆ–ç»ˆç‚¹ï¼Œä¸ä¼šåƒæ‰å…¶ä»–æ£‹å­
                if (position >= PATH_LENGTH) return;
                
                // æ£€æŸ¥å…¶ä»–ç©å®¶çš„æ£‹å­
                for (let otherPlayerId in gameState.players) {
                    if (otherPlayerId === playerId) continue;
                    
                    const otherPlayer = gameState.players[otherPlayerId];
                    
                    otherPlayer.pieces.forEach((piece, pieceIndex) => {
                        // å¦‚æœå…¶ä»–ç©å®¶çš„æ£‹å­åœ¨ç›¸åŒä½ç½®ï¼Œä¸”ä¸æ˜¯å®‰å…¨ä½ç½®ï¼Œåˆ™è¢«åƒæ‰
                        if (piece.position === position && !SAFE_SPACES.includes(position)) {
                            piece.position = -1;
                            piece.onPath = false;
                            
                            // æ›´æ–°UI
                            renderPieces();
                            
                            // æ˜¾ç¤ºæ¶ˆæ¯
                            const message = gameState.players[playerId].isComputer 
                                ? `ç”µè„‘ ${playerId} åƒæ‰äº†${gameState.players[otherPlayerId].isComputer ? 'ç”µè„‘' : 'ä½ '} ${otherPlayerId} çš„æ£‹å­ï¼` 
                                : `ä½ åƒæ‰äº†${gameState.players[otherPlayerId].isComputer ? 'ç”µè„‘' : ''} ${otherPlayerId} çš„æ£‹å­ï¼`;
                            
                            showGameMessage(message);
                        }
                    });
                }
            }

            // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
            function checkGameOver(playerId) {
                const player = gameState.players[playerId];
                return player.pieces.every(piece => piece.position >= PATH_LENGTH + 5);
            }

            // ä¸‹ä¸€ä¸ªç©å®¶
            function nextPlayer() {
                const playerCount = Object.keys(gameState.players).length;
                gameState.currentPlayer = (gameState.currentPlayer % playerCount) + 1;
                gameState.diceRolled = false;
                
                // æ›´æ–°UI
                document.getElementById('diceValue').textContent = gameState.players[gameState.currentPlayer].isComputer 
                    ? `ç”µè„‘ ${gameState.currentPlayer} çš„å›åˆ` 
                    : 'ä½ çš„å›åˆï¼Œè¯·æ·éª°å­';
                
                updateCurrentPlayer();
                renderPieces();
            }

            // æ˜¾ç¤ºæ¸¸æˆæ¶ˆæ¯
            function showGameMessage(message) {
                const gameMessage = document.getElementById('gameMessage');
                gameMessage.textContent = message;
                gameMessage.classList.remove('opacity-0');
                
                setTimeout(() => {
                    gameMessage.classList.add('opacity-0');
                }, 3000);
            }

            // æ˜¾ç¤ºæ¸¸æˆç»“æŸå¼¹çª—
            function showGameOverModal(winnerId) {
                const modal = document.getElementById('gameOverModal');
                const modalContent = document.getElementById('modalContent');
                const winnerText = document.getElementById('winnerText');
                const winnerMessage = document.getElementById('winnerMessage');
                
                const winnerName = gameState.players[winnerId].isComputer ? `ç”µè„‘ ${winnerId}` : 'ä½ ';
                
                winnerText.textContent = 'æ¸¸æˆç»“æŸ';
                winnerMessage.textContent = `${winnerName} è·èƒœï¼æ­å–œï¼`;
                
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 100);
            }

            // é‡ç½®æ¸¸æˆ
            function resetGame() {
                gameState = {
                    players: {},
                    currentPlayer: 1,
                    diceRolled: false,
                    diceValue: 0,
                    gameStarted: false,
                    gameOver: false
                };
                
                document.getElementById('diceValue').textContent = 'ç‚¹å‡»éª°å­å¼€å§‹æ¸¸æˆ';
                document.getElementById('gameBoard').innerHTML = '';
                document.getElementById('playerInfo').innerHTML = '';
                
                // éšè—æ¸¸æˆç»“æŸå¼¹çª—
                const modal = document.getElementById('gameOverModal');
                const modalContent = document.getElementById('modalContent');
                modalContent.classList.remove('scale-100', 'opacity-100');
                modalContent.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
                
                showGameMessage('æ¸¸æˆå·²é‡ç½®');
            }

            // äº‹ä»¶ç›‘å¬
            document.getElementById('startGame').addEventListener('click', initGame);
            document.getElementById('resetGame').addEventListener('click', resetGame);
            document.getElementById('diceContainer').addEventListener('click', rollDice);
            document.getElementById('playAgain').addEventListener('click', () => {
                resetGame();
                initGame();
            });
        });
    </script>
</body>
</html>
    